---
- hosts: testmachines
  name: testing of ansible
  remote_user: ubuntu	
  tasks:
   - name: Transfer metricbeat installation file to machines
     copy:
      src: metricbeat-7.2.0-amd64.deb
      dest: ~/metricbeat-7.2.0-amd64.deb
      owner: ubuntu
      group: ubuntu
      mode: u=rwx,g=r,o=r 
   
   - name: check if metric beat installed
     command: dpkg-query -W metricbeat
     register: metric_beat_exist
     failed_when: metric_beat_exist.rc > 1
     changed_when: metric_beat_exist.rc == 1

   - name: install metricbeat
    
 apt: 
      deb: ~/metricbeat-7.2.0-amd64.deb
     when: metric_beat_exist.rc == 1
    
